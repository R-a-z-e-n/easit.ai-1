import React from 'react';
import type { Conversation } from '../types';
import { MessageSquarePlus, MessageSquareText, X } from 'lucide-react';

interface SidebarProps {
  conversations: Conversation[];
  activeConversationId: string | null;
  onSelectConversation: (id: string) => void;
  onNewConversation: () => void;
  isMobileOpen: boolean;
  onClose: () => void;
}

const logoUrl = 'data:image/jpeg;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB//Z';

const timeAgo = (dateString: string): string => {
  const date = new Date(dateString);
  const now = new Date();
  const seconds = Math.round((now.getTime() - date.getTime()) / 1000);
  const minutes = Math.round(seconds / 60);
  const hours = Math.round(minutes / 60);
  const days = Math.round(hours / 24);

  if (seconds < 60) return "just now";
  if (minutes < 60) return `${minutes}m ago`;
  if (hours < 24) return `${hours}h ago`;
  if (days === 1) return "Yesterday";
  if (days < 7) return `${days}d ago`;
  
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

export const Sidebar: React.FC<SidebarProps> = ({
  conversations,
  activeConversationId,
  onSelectConversation,
  onNewConversation,
  isMobileOpen,
  onClose,
}) => {
  return (
    <>
      {isMobileOpen && <div className="fixed inset-0 bg-black/30 z-30 md:hidden" onClick={onClose}></div>}
      <aside className={`fixed top-0 left-0 h-full z-40 w-64 bg-white/5 dark:bg-gray-800/20 backdrop-blur-lg border-r border-white/10 dark:border-gray-700/50 flex flex-col transition-transform duration-300 ${isMobileOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
        <div className="flex items-center justify-between p-4 border-b border-white/10 dark:border-gray-700/50">
          <img src={logoUrl} alt="Easit.ai Assistant Logo" className="h-9 w-auto" />
          <button onClick={onClose} className="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 md:hidden" aria-label="Close sidebar">
              <X size={20} />
          </button>
        </div>
        <div className="p-2">
          <button
            onClick={onNewConversation}
            className="flex items-center gap-2 w-full p-2.5 my-2 rounded-lg text-sm font-semibold bg-brand-blue text-white hover:bg-brand-blue/90 transition-colors duration-200"
          >
            <MessageSquarePlus size={18} />
            New Chat
          </button>
          <nav className="flex-1 overflow-y-auto space-y-1 pr-1 max-h-[calc(100vh-200px)]">
            {conversations.length > 0 ? (
              conversations.map((conv) => (
                <a
                  key={conv.id}
                  href="#"
                  onClick={(e) => {
                    e.preventDefault();
                    onSelectConversation(conv.id);
                  }}
                  className={`flex items-start gap-2.5 p-2.5 rounded-lg text-sm transition-colors duration-200 ${
                    activeConversationId === conv.id
                      ? 'bg-brand-blue/20 text-brand-blue dark:text-white'
                      : 'hover:bg-gray-200/50 dark:hover:bg-gray-700/50'
                  }`}
                >
                  <MessageSquareText size={18} className="mt-0.5 flex-shrink-0" />
                  <div className="flex-1 overflow-hidden">
                    <p className="text-sm font-medium truncate">{conv.title}</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400 truncate">
                      {timeAgo(conv.createdAt)}
                    </p>
                  </div>
                </a>
              ))
            ) : (
              <div className="text-center text-xs text-gray-500 dark:text-gray-400 p-4 mt-4">
                No past conversations. Start a new chat to begin!
              </div>
            )}
          </nav>
        </div>
        <div className="mt-auto p-2 border-t border-white/10 dark:border-gray-700/50">
          <p className="text-xs text-center text-gray-500 dark:text-gray-400">
            Easit.ai v1.0
          </p>
        </div>
      </aside>
    </>
  );
};